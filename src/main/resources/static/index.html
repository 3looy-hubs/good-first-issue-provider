<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Issues Table</title>
    <script src="https://cdn.tailwindcss.com"></script> <!-- Load Tailwind CSS -->
</head>
<body class="bg-gray-100">

<div class="container mx-auto py-10">
    <h1 class="text-3xl font-bold mb-6 text-center">Hiero Good First Issues</h1>

    <div class="container mx-auto py-10">
        <!-- Loading Text -->
        <div id="loading" class="text-center text-xl text-gray-700">LOADING...</div>

        <!-- Table for Issues -->
        <div id="table-container" class="overflow-x-auto hidden">
            <table class="min-w-full bg-white border border-gray-200">
                <thead class="bg-gray-100">
                <tr>
                    <th class="px-6 py-3 border-b text-left">Title</th>
                    <th class="px-6 py-3 border-b text-left">Languages</th>
                    <th class="px-6 py-3 border-b text-left">Repository</th>
                    <th class="px-6 py-3 border-b text-left">Link</th>
                </tr>
                </thead>
                <tbody id="issues-table-body">
                <!-- Issues will be loaded here by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
  // Function to fetch issues from the REST API endpoint
  async function fetchIssues() {
    const response = await fetch('/good-first-issues');
    const issues = await response.json();
    return issues;
  }

  // Function to render issues into the table
  function renderIssues(issues) {
    const tableBody = document.getElementById('issues-table-body');
    tableBody.innerHTML = ''; // Clear any existing rows

    issues.forEach(issue => {
      if(issue.isAssigned) {
        return;
      }
      if(issue.isClosed) {
        return;
      }
      const row = document.createElement('tr');
      row.innerHTML = `
                    <td class="px-6 py-4 border-b">${issue.title}</td>
                    <td class="px-6 py-4 border-b">${issue.languageTags.map(tag => tag).join(', ')}</td>
                    <td class="px-6 py-4 border-b"><a href="https://github.com/${issue.org}/${issue.repo}" class="text-blue-600 hover:underline" target="_blank">${issue.repo}</a></td>
                    <td class="px-6 py-4 border-b"><a href="${issue.html_url}" class="text-blue-600 hover:underline" target="_blank">View Issue</a></td>
                `;
      tableBody.appendChild(row);
    });
  }

  // Load issues on page load
  document.addEventListener('DOMContentLoaded', async () => {
    const loadingElement = document.getElementById('loading');
    const tableContainer = document.getElementById('table-container');

    try {
      const issues = await fetchIssues();
      renderIssues(issues);
      // Hide the loading text and show the table
      loadingElement.classList.add('hidden');
      tableContainer.classList.remove('hidden');
    } catch (error) {
      loadingElement.textContent = 'Failed to load data. Please try again later.';
    }
  });
</script>

</body>
</html>